"use strict";(self.webpackChunkpayload_blog_typescript=self.webpackChunkpayload_blog_typescript||[]).push([[771],{59771:(e,t,l)=>{l.r(t),l.d(t,{default:()=>h});var a=l(67294),i=l(16550),s=l(9980),o=l(28630),n=l(75091),d=l(47489),r=l(2143),c=l(88348),u=l(83780);const p=(e,t)=>t?e.fields.filter((e=>(0,u.fieldAffectsData)(e)&&"id"!==e.name||!0)):e.fields;var f=l(19826),v=l(40684),$=l(45074),m=l(91455),b=l(30894);const h=e=>{var t,l,u;const{collection:h,isEditing:g}=e,{slug:E,labels:{plural:S},admin:{useAsTitle:k,components:{views:{Edit:w}={}}={}}={}}=h,[y]=(0,a.useState)((()=>p(h,g))),[C]=(0,a.useState)((()=>({...h,fields:y}))),[P,Z]=(0,a.useState)(),_=(0,v.bU)(),{serverURL:L,routes:{admin:U,api:A}}=(0,s.Z)(),{params:{id:D}={}}=(0,i.$B)(),{state:N}=(0,i.TH)(),R=(0,i.k6)(),{setStepNav:T}=(0,n.FP)(),[x,B]=(0,a.useState)(),{permissions:F,user:G}=(0,o.a)(),{getVersions:H,preferencesKey:K}=(0,$.x5)(),{getPreference:V}=(0,m.G)(),j=(0,a.useCallback)((async e=>{var t;if(H(),g){const t=await(0,f.Z)({fieldSchema:C.fields,data:e.doc,user:G,id:D,operation:"update",locale:_});B(t)}else Z(`${U}/collections/${C.slug}/${null===(t=null==e?void 0:e.doc)||void 0===t?void 0:t.id}`)}),[U,C,g,H,G,D,_]),[{data:q,isLoading:z,isError:I}]=(0,d.Z)(g?`${L}${A}/${E}/${D}`:null,{initialParams:{"fallback-locale":"null",depth:0,draft:"true"}}),J=(null==N?void 0:N.data)||q;if((0,a.useEffect)((()=>{const e=[{url:`${U}/collections/${E}`,label:S}];if(g){let t="";J&&(t=k?J[k]?J[k]:"[Untitled]":J.id),e.push({label:t})}else e.push({label:"Create New"});T(e)}),[T,g,S,J,E,k,U]),(0,a.useEffect)((()=>{if(z)return;(async()=>{const e=await(0,f.Z)({fieldSchema:y,data:J,user:G,operation:g?"update":"create",id:D,locale:_});await V(K),B(e)})()}),[J,y,g,D,G,_,z,K,V]),(0,a.useEffect)((()=>{P&&R.push(P)}),[R,P]),I)return a.createElement(i.l_,{to:`${U}/not-found`});const M=null===(t=null==F?void 0:F.collections)||void 0===t?void 0:t[E],O=`${L}${A}/${E}/${D}${C.versions.drafts?"?draft=true":""}`,Q=`${L}${A}/${E}${g?`/${D}`:""}?locale=${_}&depth=0&fallback-locale=null`,W=g&&(null===(l=null==M?void 0:M.update)||void 0===l?void 0:l.permission)||!g&&(null===(u=null==M?void 0:M.create)||void 0===u?void 0:u.permission);return a.createElement(b.f.Provider,{value:1},a.createElement(r.Z,{DefaultComponent:c.Z,CustomComponent:w,componentProps:{id:D,isLoading:!x,data:J,collection:C,permissions:M,isEditing:g,onSave:j,initialState:x,hasSavePermission:W,apiURL:O,action:Q}}))}}}]);